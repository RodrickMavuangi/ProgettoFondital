@page "/detailservicepartner/{servicePId}"
@inherits DetailServicePartnerBase
@attribute [Authorize]
@inject IStringLocalizer<App> localizer

@if (ServicePartnerModel_UpdateSP.Id == default)
{
    <p>@localizer["Caricamento"]...</p>
}
else
{
    <div class="under-Header">
        <div class="u-h-left">
            <div class="top">
                <div class="TechSt"><strong>@ServicePartnerModel_UpdateSP.RagioneSociale</strong></div>
                <div class="butt"><TelerikButton OnClick=@EditSp>@localizer["ModificaSP"]</TelerikButton></div>
            </div>
            <hr />
            <div class="middle">
                <div class="Forn"><span class="span">@localizer["CodiceFornitore"] : </span><strong>@ServicePartnerModel_UpdateSP.CodiceFornitore</strong> </div>
                <div class="CClient"><span class="span">@localizer["CodiceCliente"] : </span><strong>@ServicePartnerModel_UpdateSP.CodiceCliente</strong></div>
            </div>
            <hr />
            <div class="bottom"></div>
        </div>

        <div class="u-h-right">
            <div class="btn-ad">
                <div class="bloc-sin-a-Add">
                    <span class="utent">@localizer["Utenti"]</span>
                    <span class="ut-Abil">@localizer["Abilitati"] / @UtentiAbilitati</span>
                    <span class="ut-Disab">@localizer["Disabilitati"] / @UtentiDisabilitati</span>
                </div>
                <div>
                    <TelerikButton Class="btn-add" OnClick=@(()=> ShowEditUserDialog = true)>@localizer["AggiungiUtente"]</TelerikButton>
                </div>

            </div>
            <div class="Cerca">
                <div>
                    <input class="border-rod-first" @bind-value="SearchText" @bind-value:event="oninput" placeholder=@localizer["CercaUtenti"] />
                </div>
                <div class="border-rod">
                    <TelerikDropDownList Width="180px" Class="border-rod" PopupClass="dropdown-ite"
                                         Data="@ListaScelta" ValueChanged="@( (string v) => MyValueChangeHandler(v) )" DefaultText="@((SceltaCorrente==null)?@localizer["StatoUtente"]:null)">
                    </TelerikDropDownList>
                </div>
            </div>
        </div>
    </div>
}

@*Modal per la modifica del service partner
    <TelerikWindow Class="modal-app" Width="360px" Height="330px" Centered="true" @bind-Visible="isModalVisible" Modal="true">
        <WindowActions>
            <WindowAction Name="Close" />
        </WindowActions>
        <WindowContent>
            @if (ValidSubmit)
            {
                <div class="" role="alert">
                    @localizer["Caricamento"]...
                </div>
            }
            else
            {
                <TelerikForm Model="ServicePartnerModel_UpdateSP" OnSubmit="OnSubmit_updateService_HandlerAsync" EditContext="myEditContext_UpdateSP">
                    <FormValidation>
                        <DataAnnotationsValidator></DataAnnotationsValidator>
                    </FormValidation>
                    <FormItems>
                        <FormItem Field="@nameof(ServicePartnerDto.CodiceCliente)"></FormItem>
                        <FormItem Field="@nameof(ServicePartnerDto.CodiceFornitore)"></FormItem>
                        <FormItem Field="@nameof(ServicePartnerDto.RagioneSociale)"></FormItem>
                    </FormItems>
                    <FormButtons>
                        <TelerikButton Class="btn btn-secondary mr-auto" @onclick="() => isModalVisible = false" ButtonType="@ButtonType.Button">@localizer["Cancella"]</TelerikButton>
                        <TelerikButton Class="btn btn-success ml-auto" ButtonType="@ButtonType.Submit">@localizer["Modifica"]</TelerikButton>
                    </FormButtons>
                </TelerikForm>
            }
        </WindowContent>
    </TelerikWindow>
*@


@*Modal per la modifica dell'utente
    <TelerikWindow Class="modal-app" Width="360px" Height="330px" Centered="true" @bind-Visible="myEditTemplate" Modal="true">
        <WindowActions>
            <WindowAction Name="Close" />
        </WindowActions>
        <WindowContent>
            @if (ValidSubmit)
            {
                <div class="" role="alert">
                    @localizer["Caricamento"]...
                </div>
            }
            else
            {
                <TelerikForm Model="@UtenteModel_EditUtente" OnSubmit="@EditUtente_UpdateHandler" EditContext="myEditContext_UpdateUtente">
                    <FormValidation>
                        <DataAnnotationsValidator></DataAnnotationsValidator>
                    </FormValidation>
                    <FormItems>
                        <FormItem Field="@nameof(UtenteDto.Email)" Enabled="false"></FormItem>
                        <FormItem Field="@nameof(UtenteDto.Nome)"></FormItem>
                        <FormItem Field="@nameof(UtenteDto.Cognome)"></FormItem>
                    </FormItems>
                    <FormButtons>
                        @*<TelerikButton Class="btn btn-secondary mr-auto" @onclick="() => myEditTemplate = false" ButtonType="@ButtonType.Button">@localizer["Cancella"]</TelerikButton>
                        <TelerikButton Class="btn btn-success ml-auto" ButtonType="@ButtonType.Submit">@localizer["Modifica"]</TelerikButton>
                    </FormButtons>
                </TelerikForm>
            }
        </WindowContent>
    </TelerikWindow>
*@


@*Modal per l'aggiunta dell'utente*@
<TelerikWindow Class="modal-app" Width="350px" Height="330px" Centered="true" @bind-Visible=@WindowVisible Modal="true">
    <WindowActions>
        <WindowAction Name="Close" />
    </WindowActions>
    <WindowContent>
        <div class="demo-section">
            @if (ValidSubmit)
            {
                <div class="" role="alert">
                    @localizer["Caricamento"]...
                </div>
            }
            else
            {
                <TelerikForm Model="@ServicePartnerModel_AddUtente" OnSubmit="OnSubmitHandlerAsync" EditContext="myEditContext_AddUTente" ValidationMessageType="@FormValidationMessageType.Inline">
                    <FormValidation>
                        <DataAnnotationsValidator></DataAnnotationsValidator>
                    </FormValidation>
                    <FormItems>
                        <FormItem Field="@nameof(UtenteDto.UserName)"></FormItem>
                        <FormItem Field="@nameof(UtenteDto.Nome)"></FormItem>
                        <FormItem Field="@nameof(UtenteDto.Cognome)"></FormItem>
                    </FormItems>
                    <FormButtons>
                        @*<TelerikButton Class="btn btn-secondary mr-auto" @onclick="() => WindowVisible = false" ButtonType="@ButtonType.Button">@localizer["Cancella"]</TelerikButton>*@
                        <TelerikButton Class="btn btn-success ml-auto" ButtonType="@ButtonType.Submit">@localizer["Salva"]</TelerikButton>
                    </FormButtons>
                </TelerikForm>

            }
        </div>
    </WindowContent>


</TelerikWindow>
<TelerikGrid Data="@((ConStato.Abilitati == true)? FilterdUtenti_Abilitati :(ConStato.Disabilitati == true)?FilterdUtenti_Disabilitati: FilteredUtenti)"
             EditMode="@GridEditMode.Popup"
             Pageable="true"
             Height="500px"
             Resizable="true"
             Sortable="true">
    <GridColumns>
        <GridColumn Field=@nameof(UtenteDto.UserName) Title=@localizer["UTENTI"] />
        <GridColumn Field=@nameof(UtenteDto.Nome) Title=@localizer["NOME"] />
        <GridColumn Field=@nameof(UtenteDto.Cognome) Title=@localizer["COGNOME"] />
        <GridCommandColumn Width="75px">
            @{
                UtenteDto userToEdit = (UtenteDto)context;
                <GridCommandButton Class="bt-cmd" Command="MyOwnCommand" Icon="" ShowInEdit="false" ImageUrl="/img/Icons/setting.svg" OnClick=@(() => EditUser(userToEdit.UserName))></GridCommandButton>
            }
        </GridCommandColumn>
        <GridCommandColumn Width="75px">
            <GridCommandButton Class="bt-cmd" Command="MyOwnCommand" Icon="" ShowInEdit="false" ImageUrl="/img/keyLogo.jpg" OnClick="@SendMail"></GridCommandButton>
        </GridCommandColumn>
        <GridCommandColumn Width="75px" Context="dif">
            @{ var utente = dif as UtenteDto;
                <TelerikSwitch OffLabel=" " OnLabel=" " OnChange="@(() => UpdateEnableUtente(utente.Id))" @bind-Value="@utente.IsAbilitato"></TelerikSwitch> }
        </GridCommandColumn>
    </GridColumns>
</TelerikGrid>



<TelerikWindow Class="modal-app dialogBox" Width="500px" Height="auto" Centered="true" @bind-Visible=@ShowEditSpDialog Modal="true">
    <WindowActions>
        <WindowAction Name="Close" IconClass="k-icon k-i-close text-dark" />
    </WindowActions>
    <WindowContent>
        <EditSPDialog SPToUpdate="SpSelected" OnClose="@(() => ShowEditSpDialog = false)" OnSave="CloseAndRefresh" />
    </WindowContent>
</TelerikWindow>

<TelerikWindow Class="modal-app dialogBox" Width="500px" Height="auto" Centered="true" @bind-Visible=@ShowEditUserDialog Modal="true">
    <WindowActions>
        <WindowAction Name="Close" IconClass="k-icon k-i-close text-dark" />
    </WindowActions>
    <WindowContent>
        <EditUserDialog UtenteToUpdate="UserSelected" OnClose="@(() => ShowEditUserDialog = false)" OnSave="CloseAndRefresh" />
    </WindowContent>
</TelerikWindow>



<style>
    .large-button {
        border: none;
    }

    .under-Header {
        height: 145px
    }

    .u-h-left {
        position: absolute;
        left: 24px;
        width: 630px;
    }

    .u-h-right {
        position: absolute;
        right: 24px;
        width: 840px;
        height: 130px;
        display: flex;
    }

    .top {
        display: flex;
        flex-direction: row;
    }

    .butt {
        margin-left: 425px;
    }

    .border-rod {
        width: 30px;
        position: absolute;
        right: 0px
    }

    .border-rod-first {
        margin-right: 190px;
    }

    .dropdown-ite {
        height: 130px;
    }

    .Cerca {
        display: flex;
        flex-direction: row;
        height: 60px;
        /*width: 60px;*/
        position: absolute;
        right: 8px;
        bottom: 0px
    }

    .btn-add {
        color: aliceblue;
        background-color: forestgreen;
        width: 180px;
        position: absolute;
        right: 8px;
        top: 0px;
    }

    div.k-widget.k-window.modal-app {
        width: 250px;
        height: 600px;
        border: 1px solid white
    }

    .modal-app .k-window-content.k-content.k-dialog-content {
    }

    .modal-app .k-button.telerik-blazor.k-primary.k-form-submit {
        border: 2px solid dodgerblue;
        color: aliceblue;
        background-color: dodgerblue;
        width: 700px;
    }

    .CClient {
        margin-left: 350px;
    }

    .Forn {
        float: left;
    }

    .span {
        font-size: 10px;
        padding-bottom: 20px;
    }

    .bloc-sin-a-Add {
        border-left: 1px solid #DCDCDC;
        display: flex;
        flex-direction: row;
    }

    .ut-Abil {
        width: 100px;
        height: 15px;
        color: forestgreen;
        margin-left: 15px
    }

    .ut-Disab {
        width: 100px;
        height: 15px;
        color: red;
        margin-left: 30px
    }

    .utent {
        margin-left: 8px;
        font-size: 10px;
        padding-top: 3.5px;
    }

    .TechSt {
        height: 30px
    }

    /*    .k-dialog-titlebar.k-header {
        background: white
    }*/

    GridCommandColumn {
        color: aliceblue;
        background-color: dodgerblue;
        width: 75px
    }
</style>