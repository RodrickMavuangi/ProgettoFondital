@page  "/utenzedirezione"

@inject IStringLocalizer<App> localizer
@inject MailClient mailClient
@inject UtenteClient utenteClient
@inject IConfiguration config
@attribute [Authorize(Roles = "Direzione")]

<div class="row-1 d-flex justify-content-between flex-wrap flex-md-nowrap  pt-0">
    <!--TITOLO PAGINA-->
    <div class="col-md-5  text-left pb-4 border-bottom">
        <div class="col  text-left d-inline-block ">
            <div class="page-header">
                <h1 class="h1"><b>@localizer["Anagrafiche"]</b> @localizer["Direzione"]</h1>
            </div>
        </div>
    </div>
    <!--FINE TITLE PAGE-->
    <!--ROW BOTTONI-->
    <div class="col-md-7 pb-4 border-bottom pr-0">

        <div class="col  text-left d-none barraStrumenti "> </div>
        <div class="col  text-right d-inline-block float-lg-right p-0">
            <TelerikButton Class="btn btn-primary btn-verde btn-lg mx-1" OnClick=@(()=> ShowAddDialog = true)>@localizer["AggiungiUtente"]</TelerikButton>
        </div>
    </div>
    <!--FINE BUTTON TOP DX-->
</div>
<!--FINE ROW 1 . TITOLI + BUTTON DX-->


@if (UtentiDirezione == null)
{
    @*<p><em>@localizer["Caricamento"]</em></p>*@
    <!--CARICO IL LOADER-->

    <div class="k-loader-container k-loader-container-md k-loader-top " style="" data-id="7d13dd9e-e016-4aec-8e1b-5253cd5131d5">
        <div class="k-loader-container-overlay k-overlay-light"></div>
        <div class="k-loader-container-inner ">
            <div class="k-loader k-loader-spinner-3 k-loader-lg k-loader-primary">
                <div class="k-loader-canvas">
                    <span class="k-loader-segment"></span>
                    <span class="k-loader-segment"></span>
                    <span class="k-loader-segment"></span>
                </div>
            </div>
        </div>
    </div>
}
else
{

    <!-- BARRA FILTRI-->
    <div class="row-2 d-inline w-100 mb-4 pt-0 pb-4 pt-4 border-bottom barraFiltri">
        <div class="col  text-right d-inline-block float-lg-right p-0">

            <div class="form-group rowFiltri">
                <i class="bi bi-search float-lg-right icoSearch blu"></i>
                <input class="form-control float-lg-right filtriInput mx-1" @bind-value="SearchText" @bind-value:event="oninput" placeholder=@localizer["CercaUtenti"] />
                <TelerikDropDownList Class="select mx-1" PopupClass="dropdown-ite" Data="@ListaScelta" @bind-Value="@StatusFilter" DefaultText=@localizer["Tutti"] />
            </div> <!--FINE form-group-->
        </div>
    </div>
    <!--FINE BARRA FILTRI-->

    <!--LISTA-->
    <TelerikGrid Data="@(ListaUtDirezioneFiltered)"
                 Pageable="true"
                 PageSize="PageSize"
                 Class="table table-striped"
                 Sortable="true">
        <GridColumns>
            <GridColumn Field=@nameof(UtenteDto.UserName) Title=@localizer["Utenti"].Value.ToUpper() />
            <GridColumn Field=@nameof(UtenteDto.Nome) Title=@localizer["Nome"].Value.ToUpper() />
            <GridColumn Field=@nameof(UtenteDto.Cognome) Title=@localizer["Cognome"].Value.ToUpper() />
            <GridCommandColumn Context="ut" Width="80px">
                @{
                    var utente = ut as UtenteDto;
                    <GridCommandButton Class="btnIcon bgBianco white" Command="EditUtente" Icon="" ImageUrl="/img/Icons/edit.svg" OnClick="@(() => EditUtente(utente.UserName))" />
                }
            </GridCommandColumn>
            <GridCommandColumn Context="ut" Width="80px">
                @{
                    var utente = ut as UtenteDto;
                    <GridCommandButton Class="btnIcon bgBianco white" Command="" Icon="" ImageUrl="/img/Icons/key.svg" OnClick="@(() => SendMail(utente.UserName))" />
                }
            </GridCommandColumn>
            <GridCommandColumn Context="ut" Width="80px">
                @{ var utente = ut as UtenteDto;
                    <TelerikSwitch Class="switch_white" OffLabel=" " OnLabel=" " OnChange="@(() => UpdateEnableUtente(utente.UserName))" @bind-Value="@utente.IsAbilitato"></TelerikSwitch> }
            </GridCommandColumn>
        </GridColumns>
    </TelerikGrid>
}

<!--DIALOGS-->

<TelerikWindow Class="modal-app dialogBox" Width="500px" Height="auto" Centered="true" @bind-Visible=@ShowEditDialog Modal="true">
    <WindowActions>
        <WindowAction Name="Close" IconClass="k-icon k-i-close text-dark" />
    </WindowActions>
    <WindowContent>
        <EditUtenteDialog UtenteToUpdate="UtenteSelected" OnClose="CloseAndRefresh" OnSave="CloseAndRefresh" />
    </WindowContent>
</TelerikWindow>

<TelerikWindow Class="modal-app dialogBox" Width="500px" Height="auto" Centered="true" @bind-Visible=@ShowAddDialog Modal="true">
    <WindowActions>
        <WindowAction Name="Close" IconClass="k-icon k-i-close text-dark" />
    </WindowActions>
    <WindowContent>
        <AddUtenteDialog SP=@null OnClose="CloseAndRefresh" OnSave="CloseAndRefresh" />
    </WindowContent>
</TelerikWindow>